<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>User Dashboard - RAVA</title>
  <style>
    body {
      font-family:'Inter', sans-serif;
      background:#101413;
      color:white;
      margin:0;
      padding:0;
      display:flex;
      justify-content:center;
      align-items:center;
      height:100vh;
    }
    .card {
      background:#1a1d1c;
      padding:40px 30px;
      border-radius:12px;
      border:1px solid #d4af37;
      max-width:600px;
      width:100%;
      text-align:center;
      box-shadow:0 4px 12px rgba(0,0,0,0.4);
    }
    h2 { color:#d4af37; margin-bottom:10px; }
    p { margin:8px 0; }
    code {
      background:#2b2d42;
      padding:6px 12px;
      border-radius:6px;
      display:inline-block;
      margin-top:5px;
    }
    a.btn {
      display:inline-block;
      margin-top:20px;
      padding:12px 20px;
      border-radius:6px;
      text-decoration:none;
      font-weight:bold;
      background:#d4af37;
      color:#101413;
      transition:all 0.2s;
    }
    a.btn:hover { background:#f0d65c; }
    .small {
      margin-top:15px;
      font-size:12px;
      color:#aaa;
    }
  </style>
</head>
<body>
  <div class="card" id="content">
    Loading license info...
  </div>

  <script>
    const API_BASE = "https://rava-license-server.onrender.com/api";
    const params = new URLSearchParams(window.location.search);
    const email = params.get("email") || localStorage.getItem("license_email");
    const plan = params.get("plan") || "practice";
    const content = document.getElementById("content");

    async function loadLicense() {
      if (!email) {
        content.innerHTML = `<h2>‚ùå Missing Email</h2><p>Please log in again.</p>`;
        return;
      }

      try {
        const res = await fetch(`${API_BASE}/check_license?email=${encodeURIComponent(email)}`);
        const data = await res.json();

        if (data.status === "valid") {
          localStorage.setItem("license_email", data.email);
          localStorage.setItem("license_key", data.license_key);

          content.innerHTML = `
            <h2>‚úÖ License Active</h2>
            <p><strong>Email:</strong> ${data.email}</p>
            <p><strong>Plan:</strong> ${plan.toUpperCase()}</p>
            <p><strong>Expires On:</strong> ${data.expires_on}</p>
            <p><strong>Days Remaining:</strong> ${data.days_remaining} days</p>
            <p><strong>License Key:</strong><br><code>${data.license_key}</code></p>
            <a href="RAVA-Installer.exe" class="btn">‚¨áÔ∏è Download RAVA</a>
            <p class="small">Need help? <a href="https://t.me/+d8xFrQ_JgyQ0NzY0" target="_blank" style="color:#d4af37;">Join our Telegram</a></p>
          `;
        } else if (data.status === "pending") {
          content.innerHTML = `
            <h2>‚åõ Pending</h2>
            <p>Your payment for <strong>${plan.toUpperCase()}</strong> is awaiting approval.</p>
            <p>Please refresh later or contact support.</p>
          `;
        } else if (data.status === "expired") {
          content.innerHTML = `
            <h2>‚ö†Ô∏è Expired</h2>
            <p>Your license expired on ${data.expires_on}.</p>
            <a href="pricing.html" class="btn">üîÑ Renew Plan</a>
          `;
        } else {
          content.innerHTML = `
            <h2>‚ùå Error</h2>
            <p>${data.message || "No license found"}</p>
            <a href="pricing.html" class="btn">üí≥ Get a License</a>
          `;
        }
      } catch (e) {
        console.error(e);
        content.innerHTML = "<h2>‚ùå Error</h2><p>Could not connect to server</p>";
      }
    }

    loadLicense();
    setInterval(loadLicense, 30000); // auto-refresh every 30s
  </script>
</body>
</html>
